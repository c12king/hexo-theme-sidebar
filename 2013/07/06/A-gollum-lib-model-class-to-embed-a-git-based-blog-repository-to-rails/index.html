<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>A gollum lib model class to embed a git based blog repository to rails | Hexo</title>
  <meta name="author" content="John Doe">
  
  <meta name="description" content="A rails model for gollum-lib, which is used to embed gollum into existing rails project. Just place it in app/models/. and create the corresponding co">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0>

  <meta property="og:title" content="A gollum lib model class to embed a git based blog repository to rails"/>
  <meta property="og:site_name" content="Hexo"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link rel="stylesheet" href="/css/bootstrap.min.css" type="text/css">
  <link rel="stylesheet" href="/css/simple-sidebar.css" type="text/css">
  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  <!-- <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css"> -->
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>

<body>

<div id="wrapper">

  <!-- Sidebar -->
  <div id="sidebar-wrapper">
    <ul class="sidebar-nav nav text-center">
      <li>
  <div>
    <a href="/">
      <img class="img-circle" src="/img/sword.gif" alt="Anthem" height="180" width="180">
    </a>
  </div>
</li>
<li>
  <a href="/">Hexo</a>
</li>




  <li><a href="/archives">Blog</a></li>

  <li><a href="/projects">Projects</a></li>

  <li><a href="/notes">Notes</a></li>

  <li><a href="/about">About</a></li>

    </ul>

    <div class="text-center">
    
  <p><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="hidden" name="q" value="site:http://yoursite.com"></form>
 </p>

  <p> </p>

  <p>
    <!-- <lead class="title text-center">Tags</lead> -->
    
      <a href="/tags/CS/">CS
      <span class="badge"> 1 </span></a>
    
      <a href="/tags/General/">General
      <span class="badge"> 1 </span></a>
    
      <a href="/tags/Physics/">Physics
      <span class="badge"> 2 </span></a>
    
 </p>



    
  
  &copy; 2014 John Doe
  

    </div>
  </div>

  <!-- Page content -->
  <div id="page-content-wrapper">
    <button id="menu-toggle" href="#" class="btn btn-default ">
      <span class="glyphicon glyphicon glyphicon-tasks" ></span>
    </button>

    


    <div class="content-header ">
      
        <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
      
      
  
    <h1 class="title">A gollum lib model class to embed a git based blog repository to rails</h1>
  

    </div>
    <div class="entry page-content inset ">
      
        <time datetime="2013-07-06T04:00:00.000Z"><a href="/2013/07/06/A-gollum-lib-model-class-to-embed-a-git-based-blog-repository-to-rails/">Jul 6 2013</a></time>
        <div class="icon"></div>
       <br />

      
        <p>A rails model for gollum-lib, which is used to embed <code>gollum</code> into existing rails project. Just place it in <code>app/models/.</code> and create the corresponding controller and view.</p>
<p>The <code>unindexable</code> and <code>unreadable</code> statuses are introduced to bring in some authorizations. The <code>pull</code> and <code>push</code> method is added to have the git repository sync with its <strong>remote origin</strong>. </p>
<p>This class require <code>gem &#39;html_truncator&#39;</code> to enable the truncate method.</p>
<p><a href="https://gist.github.com/hardywu/5907550" target="_blank">Gist link</a></p>
<pre><code>class Post  
  @data = Gollum::Wiki.new(&#39;doc/blog.git&#39;, :mathjax =&gt; true)  
  @@unindexable = &#39;page&#39;
  @@unreadable = &#39;pending&#39;

  def self.data
    @data
  end

  def self.reload
    @data = Gollum::Wiki.new(&#39;doc/blog.git&#39;, :mathjax =&gt; true)
  end

  include ActiveModel::AttributeMethods
  include ActiveModel::Validations
  include ActiveModel::Conversion
  extend  ActiveModel::Naming
  require &quot;html_truncator&quot;

  attr_accessor :name, :date, :raw_data, :formatted_data, :commit, :page,
                :title, :path, :versions, :format, :email, :filename

  alias :id :name                

  def initialize(attributes = {})
    attributes.each do |name, value|
      __send__(&quot;#{name}=&quot;, value)
    end
  end

  def self.find(name)
    post = @data.page(name)
    if post
      new :name =&gt; post.name,
          :raw_data =&gt; post.raw_data,
          :formatted_data =&gt; post.formatted_data,
          :title =&gt; post.title,
          :path =&gt; post.path,
          :versions =&gt; post.versions,
          :page =&gt; post,
          :format =&gt; post.format,
          :filename =&gt; post.filename
    end
  end

  def self.pages
    @data.pages.reverse.select { |page| page.versions.first.message != @@unindexable and page.versions.first.message != @@unreadable }
  end

  def self.truncate(text, number, tag = &#39;div&#39; )
    HTML_Truncator.ellipsable_tags &lt;&lt; tag
    HTML_Truncator.truncate(text, number, :ellipsis =&gt; &#39;...&#39;)
  end

  def persisted?
    self.class.data.page(name)
  end

  def save
    self.class.data.write_page(name, :markdown, raw_data, commit)
  end

  def destroy
    self.class.data.delete_page(page, commit)
  end

  def preview
    self.class.data.preview_page(name, raw_data, :markdown)
  end

  def update_attributes(hash)
    _raw_data = hash[:raw_data]
    _name = hash[:name]
    _commit = hash[:commit]
    self.class.data.update_page(page, _name, :markdown, _raw_data, _commit)
  end

  def self.push
    `cd #{@data.path} &amp;&amp; git push origin master 2&gt;&amp;1`
  end

  def self.pull
    `cd #{@data.path} &amp;&amp; git pull origin master 2&gt;&amp;1`
  end
end
</code></pre>
      
      <footer>
        
          
          
  
  <div class="tags">
    <p>Tags:
    <a href="/tags/CS/">CS</a>
    </p>
  </div>

          
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

        

        <div class="clearfix"></div>
      </footer>


      
<section id="comment">
  <!-- <h1 class="title">Comments</h1> -->

  
</section>


    </div>






  </div>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>

<!-- Custom JavaScript for the Menu Toggle -->
<script>
$("#menu-toggle").click(function(e) {
    e.preventDefault();
    $("#wrapper").toggleClass("active");
});
</script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
    equationNumbers: {
      autoNumber: "AMS"
    },
  },
  tex2jax: {
    inlineMath: [
      ['$', '$'],
      ["\\(", "\\)"]
    ],
    displayMath: [
      ['$$', '$$'],
      ["\\[", "\\]"]
    ],
    processEscapes: true
  },
  "HTML-CSS": {
    linebreaks: {
      automatic: true
    }
  },
  SVG: {
    linebreaks: {
      automatic: true
    }
  }
});
</script>


<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
</div>

</body>
</html>